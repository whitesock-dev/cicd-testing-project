name: Initialise Repo
on:
  workflow_dispatch:
  push:
    branches:
      - main

permissions:
  contents: write

jobs:
  CheckLicense:
    name: Check Unity License
    secrets: inherit
    uses: ./.github/workflows/check-license.yml
  CheckMatrix:
    name: Check Matrix File
    needs: [CheckLicense]
    if: needs.CheckLicense.outputs.state != ''
    secrets: inherit
    uses: ./.github/workflows/check-matrix.yml
  BuildRepo:
    name:  Build Repo
    needs: [CheckLicense,CheckMatrix]
    if: needs.CheckLicense.outputs.state != '' && needs.CheckMatrix.outputs.state != ''
    secrets: inherit
    uses: ./.github/workflows/build-repo.yml
    with:
      matrixFile: ${{needs.CheckMatrix.outputs.file}}